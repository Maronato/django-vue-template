version: "3.7"
services:
  grafana:
    deploy:
      labels:
        # Enable traefik
        - traefik.enable=true
        # Traefik constraints
        - traefik.tags=traefik-public
        # Use the proxy network for communication
        - traefik.docker.network=proxy
        # Grafana should live under grafana.DOMAIN
        - traefik.http.routers.grafana.rule=Host(`grafana.${DOMAIN}`)
        # Make sure the loadbalancer uses the correct port
        - traefik.http.services.grafana-service.loadbalancer.server.port=3000
        # Enable tls through Lets Encrypt
        - traefik.http.routers.grafana.tls=true
        - traefik.http.routers.grafana.tls.certresolver=le
        # Accept only https
        - traefik.http.routers.grafana.entrypoints=websecure
  portainer:
    deploy:
      labels:
        # Enable traefik
        - traefik.enable=true
        # Traefik constraints
        - traefik.tags=traefik-public
        # Use the proxy network for communication
        - traefik.docker.network=proxy
        # Portainer should live under portainer.DOMAIN
        - traefik.http.routers.portainer.rule=Host(`portainer.${DOMAIN}`)
        # Make sure the loadbalancer uses the correct port
        - traefik.http.services.portainer-service.loadbalancer.server.port=9000
        # Enable tls through Lets Encrypt
        - traefik.http.routers.portainer.tls=true
        - traefik.http.routers.portainer.tls.certresolver=le
        # Accept only https
        - traefik.http.routers.portainer.entrypoints=websecure
